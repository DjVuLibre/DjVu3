//C-  -*- C++ -*-
//C-
//C-  Copyright (c) 1998 AT&T	
//C-  All Rights Reserved 
//C-
//C-  THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF AT&T
//C-  The copyright notice above does not evidence any
//C-  actual or intended publication of such source code.
//C-
//C-  $Id: ATTLicense.cpp.in,v 1.2 1999-03-01 17:02:44 leonb Exp $

#include <stdlib.h>
#include <stdio.h>
#include "ATTLicense.h"
#include "ByteStream.h"
#include "BSByteStream.h"

static const char *the_copyright = 
"copyright (c) AT&T 1999";

static const char *the_usage = 
"\tThis program is copyright (c) AT&T 1999.\n"
"\tUse option \'-license\' to see the licensing terms\n";

static const char *the_license = 
@ATTLICENSE@
"\000";

const char*
ATTLicense::get_license_text()
{
  return the_license;
}

const char*
ATTLicense::get_copyright_text()
{
  return the_copyright;
}

const char*
ATTLicense::get_usage_text()
{
  return the_usage;
}

void
ATTLicense::process_cmdline(int argc, char **argv)
{
  // Check cmdline
  int i;
  for (i=1; i<argc; i++)
    {
      char *s = argv[i];
      while (*s=='-')
        s++;
      if (strcmp(s,"license")==0)
        break;
    }
  if (i>=argc)
    return;
  // Display license
#ifdef UNIX
  char *pager = getenv("PAGER");
  if (pager==0) 
    pager="more";
  FILE *f = popen(pager,"w");
  if (f)
    {
      StaticByteStream input(the_license);
      StdioByteStream output(f, "w");
      output.copy(input);
      if (pclose(f) >= 0)
        exit(0);
    }
#endif
  fprintf(stdout,"\n%s\n", (const char*)get_license_text());
  exit(0);
}
